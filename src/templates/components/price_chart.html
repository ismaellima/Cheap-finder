<!-- Price chart component: pass trend (PriceTrend object) and element_id -->
{% if trend and trend.price_history %}
<div class="bg-neutral-900 dark:bg-neutral-900 light:bg-white border border-neutral-800 dark:border-neutral-800 light:border-neutral-200 rounded-lg p-6">
  <div class="flex items-center justify-between mb-4">
    <h3 class="text-sm font-medium text-neutral-400 uppercase tracking-wider">Price History</h3>
    <div class="flex items-center gap-4 text-xs text-neutral-500">
      <span>Low: <span class="text-green-500 font-medium">${{ "%.2f" | format(trend.lowest_price / 100) }}</span></span>
      <span>High: <span class="text-red-400 font-medium">${{ "%.2f" | format(trend.highest_price / 100) }}</span></span>
      <span>Avg: <span class="text-neutral-300 font-medium">${{ "%.2f" | format(trend.average_price / 100) }}</span></span>
    </div>
  </div>
  <div class="relative" style="height: 250px;">
    <canvas id="{{ element_id }}"></canvas>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const ctx = document.getElementById('{{ element_id }}').getContext('2d');
  const isDark = document.documentElement.classList.contains('dark');

  const data = {{ trend.price_history | tojson }};
  const labels = data.map(d => {
    const date = new Date(d.date);
    return date.toLocaleDateString('en-CA', { month: 'short', day: 'numeric' });
  });
  const prices = data.map(d => d.price / 100);

  new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Price (CAD)',
        data: prices,
        borderColor: '#22c55e',
        backgroundColor: 'rgba(34, 197, 94, 0.1)',
        borderWidth: 2,
        pointRadius: 3,
        pointBackgroundColor: '#22c55e',
        fill: true,
        tension: 0.3,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: isDark ? '#262626' : '#fff',
          titleColor: isDark ? '#fafafa' : '#0a0a0a',
          bodyColor: isDark ? '#a1a1aa' : '#52525b',
          borderColor: isDark ? '#404040' : '#e5e5e5',
          borderWidth: 1,
          padding: 12,
          callbacks: {
            label: (ctx) => `$${ctx.parsed.y.toFixed(2)} CAD`
          }
        }
      },
      scales: {
        x: {
          grid: { color: isDark ? '#1a1a1a' : '#f5f5f5' },
          ticks: { color: isDark ? '#525252' : '#a3a3a3', maxTicksLimit: 10 }
        },
        y: {
          grid: { color: isDark ? '#1a1a1a' : '#f5f5f5' },
          ticks: {
            color: isDark ? '#525252' : '#a3a3a3',
            callback: (v) => '$' + v.toFixed(0)
          }
        }
      }
    }
  });
});
</script>
{% else %}
<div class="bg-neutral-900 dark:bg-neutral-900 light:bg-white border border-neutral-800 dark:border-neutral-800 light:border-neutral-200 rounded-lg p-6 text-center text-neutral-500">
  No price history yet. Prices are checked daily.
</div>
{% endif %}
