{% extends "base.html" %}
{% block title %}{{ product.name }} â€” Cheap Finder{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<div class="flex items-center gap-2 text-sm text-neutral-500 mb-6 overflow-x-auto whitespace-nowrap">
  <a href="/" class="hover:text-white transition-colors shrink-0">Dashboard</a>
  <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
  </svg>
  {% if product.brand %}
  <a href="/brands/{{ product.brand.id }}" class="hover:text-white transition-colors shrink-0">{{ product.brand.name }}</a>
  <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
  </svg>
  {% endif %}
  <span class="text-neutral-300 truncate">{{ product.name }}</span>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
  <!-- Left: Image + Info -->
  <div>
    <!-- Image -->
    <div class="bg-neutral-900 dark:bg-neutral-900 light:bg-white border border-neutral-800 dark:border-neutral-800 light:border-neutral-200 rounded-lg overflow-hidden mb-6 flex items-center justify-center" style="max-height: 60vh;">
      {% if product.image_url %}
      <img src="{{ product.image_url }}" alt="{{ product.name }}" class="w-full object-contain" style="max-height: 60vh;"
           onerror="this.style.display='none';">
      {% else %}
      <div class="w-full h-64 flex items-center justify-center text-neutral-700">
        <svg class="w-24 h-24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
      </div>
      {% endif %}
    </div>

    <!-- Product info -->
    <div class="space-y-4">
      <div>
        <span class="text-xs font-medium text-neutral-500 uppercase tracking-wider">
          {{ product.brand.name if product.brand else '' }}
        </span>
        <h1 class="text-xl font-semibold text-white dark:text-white light:text-neutral-900 mt-1">
          {{ product.name }}
        </h1>
      </div>

      <!-- Price -->
      <div class="flex items-center gap-3">
        <span class="text-2xl font-bold {% if product.on_sale %}text-green-500{% else %}text-white dark:text-white light:text-neutral-900{% endif %}">
          {{ format_price(product.current_price) }}
        </span>
        {% if product.on_sale and product.original_price %}
        <span class="text-lg text-neutral-500 line-through">
          {{ format_price(product.original_price) }}
        </span>
        {% set discount = ((product.original_price - product.current_price) / product.original_price * 100) | int %}
        <span class="text-sm font-medium text-green-500 bg-green-500/10 px-2 py-1 rounded">
          -{{ discount }}%
        </span>
        {% endif %}
      </div>

      <!-- Gender + Retailer + Link -->
      <div class="flex items-center gap-4">
        {% if product.gender %}
        <span class="text-xs font-medium uppercase px-2 py-1 rounded
          {% if product.gender == 'men' %}text-blue-400 bg-blue-500/10
          {% elif product.gender == 'women' %}text-pink-400 bg-pink-500/10
          {% else %}text-neutral-400 bg-neutral-700{% endif %}">
          {{ product.gender }}
        </span>
        {% endif %}
        {% if product.retailer %}
        <span class="text-sm text-neutral-400">{{ product.retailer.name }}</span>
        {% endif %}
        <a href="{{ product.url }}" target="_blank" rel="noopener"
           class="text-sm text-green-500 hover:text-green-400 transition-colors flex items-center gap-1">
          View at retailer
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
          </svg>
        </a>
      </div>

      {% if product.last_checked %}
      <p class="text-xs text-neutral-600">
        Last checked: {{ product.last_checked.strftime('%B %d, %Y at %H:%M UTC') }}
      </p>
      {% endif %}

      <!-- Also Available At -->
      {% if similar_products %}
      <div class="mt-6">
        <h3 class="text-sm font-medium text-neutral-400 uppercase tracking-wider mb-3">Also Available At</h3>
        <div class="space-y-2">
          {% for sp in similar_products %}
          <a href="/products/{{ sp.id }}" class="flex items-center justify-between bg-neutral-900 dark:bg-neutral-900 light:bg-white border border-neutral-800 dark:border-neutral-800 light:border-neutral-200 rounded-lg p-3 hover:border-neutral-600 dark:hover:border-neutral-600 light:hover:border-neutral-400 transition-colors">
            <div class="flex items-center gap-3 min-w-0">
              <span class="text-sm font-medium text-neutral-300 dark:text-neutral-300 light:text-neutral-700 shrink-0">{{ sp.retailer.name }}</span>
              <span class="text-xs text-neutral-500 truncate">{{ sp.name }}</span>
            </div>
            <div class="flex items-center gap-2 shrink-0 ml-3">
              <span class="text-sm font-medium {% if sp.current_price and product.current_price and sp.current_price < product.current_price %}text-green-500{% elif sp.current_price and product.current_price and sp.current_price > product.current_price %}text-red-400{% else %}text-neutral-300 dark:text-neutral-300 light:text-neutral-700{% endif %}">
                {{ format_price(sp.current_price) }}
              </span>
              {% if sp.current_price and product.current_price and sp.current_price < product.current_price %}
              <span class="text-[10px] font-medium text-green-400 bg-green-500/10 px-1.5 py-0.5 rounded uppercase">Cheaper</span>
              {% endif %}
            </div>
          </a>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Right: Price chart -->
  <div>
    {% set element_id = "price-chart" %}
    {% include "components/price_chart.html" %}
  </div>
</div>
{% endblock %}
